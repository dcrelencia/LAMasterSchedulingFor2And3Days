<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj8Sk"
        crossorigin="anonymous">
    <title>Daily Flight Schedule</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.2/xlsx.full.min.js"></script>
</head>
<body>
    <h1 style="text-align:center">PPTs and LAs Master Scheduling Program</h1>
    <div class="conatiner mt-5">
        <div class="row"> 
            <div class="col-md-3"></div>
            <div class="col-md-3">
                <input class="form-control" type="file" id="input" accept=".xls,.xlsx"  >
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary" id="button">View Data</button>
            </div>
<div class="col-md-12">
    <pre id="jsondata"></pre>
</div>
        </div>
    </div>
</body>
<footer>
    <p>Instructions: <br>
    <p>1.) Upload/Attach the excel file that contains the simplified L/A Schedule schedule format <br>
    <p>2.) Once the excel file is uploaded/attached, click the "View Data" button <br>
    <p>3.) This program will only accept 4 to 7 day availability <br>
    <p>4.) Work in progress: 2-3 day availability, Daily, and Electronic distribution <br>
    
    </p>
  </footer>

<script>
//changes from previous version: effectiveDate = currentDate, rowObject = rowObject
//https://levelup.gitconnected.com/how-to-convert-excel-file-into-json-object-by-using-javascript-9e95032d48c5
let selectedFile;
console.log(window.XLSX);
document.getElementById('input').addEventListener("change", (event) => {
    selectedFile = event.target.files[0];
})

let data=[{
    "name":"test",
    "data":"scd",
    "abc":"sdef"
}]

const daysOfTheWeek = [
    'SUNDAY',
    'MONDAY',
    'TUESDAY',
    'WEDNESDAY',
    'THURSDAY',
    'FRIDAY',
    'SATURDAY'
];

var secondWeekPass = false;
var counter1 = 0;
var counter2 = 0;
var counter11 = 0;
var counter22 = 0;
var day1, day2, day3, day4, day5, day6, day7, day8, day9, day10, day11, day12, day13, day14;

var total1 = 0;
var total2 = 0;
var total3 = 0;
var total4 = 0;
var total5 = 0;
var total6 = 0;
var total7 = 0;

function ExcelDateToJSDate(date) {
  return new Date(Math.round((date - 25569)*86400*1000));
}

document.getElementById('button').addEventListener("click", () => {
    XLSX.utils.json_to_sheet(data, 'out.xlsx');
    if(selectedFile){
        let fileReader = new FileReader();
        fileReader.readAsBinaryString(selectedFile);
        fileReader.onload = (event)=>{
         let data = event.target.result;
         //https://stackoverflow.com/questions/62770664/date-format-changing-when-converting-xlsx-to-json
         let workbook = XLSX.read(data, { type: 'binary' , cellDates: true }); //XLSX.read(data,{type:"binary"}); -> Have to use w/ ExcelDateToJSDate https://stackoverflow.com/questions/16229494/converting-excel-date-serial-number-to-date-using-javascript/67130235#67130235
         console.log(workbook);
         workbook.SheetNames.forEach(sheet => {
            let rowObject = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheet]);

document.write('Notes:', '<br>');
document.write(
    'Copy the desired data below and paste the data in Excel. The data will automatically split into different cells.',
    '<br>',
    '<br>'
);
document.write(
    '<table width="100%" border-collapse="collapse">',
    '<tr>',
    '<td text-align="100px">',
    'Name',
    '</td>',
    '<td width="100px">',
    'Sun',
    '</td>',
    '<td width="100px">',
    'Mon',
    '</td>',
    '<td width="100px">',
    'Tue',
    '</td>',
    '<td width="100px">',
    'Wed',
    '</td>',
    '<td width="100px">',
    'Thur',
    '</td>',
    '<td width="100px">',
    'Fri',
    '</td>',
    '<td width="100px">',
    'Sat',
    '</td>',
    '<td width="100px">',
    'Sun',
    '</td>',
    '<td width="100px">',
    'Mon',
    '</td>',
    '<td width="100px">',
    'Tue',
    '</td>',
    '<td width="100px">',
    'Wed',
    '</td>',
    '<td width="100px">',
    'Thur',
    '</td>',
    '<td width="100px">',
    'Fri',
    '</td>',
    '<td width="100px">',
    'Sat',
    '</td>',
    '</tr>',
    '</table>'
);

var totalPayPeriodWorkDays = [];
//Create a local array which its index will represent the LA employee and its element will be the amount of days worked
for (var i = 0; i < rowObject.length; i++) {
    if (rowObject.Name !== null) totalPayPeriodWorkDays.push(0); //initial work days is 0
}
console.log(totalPayPeriodWorkDays.length);

for (var i = 0; i < rowObject.length; i++) {
    document.write(
        '<table width="100%" border-collapse="collapse">',
        '<tr>',
        '<td width="100px">',
        rowObject[i].Name,
        '</td>'
    );
        var firstWeek = Math.floor(Math.random() * (4 - 3 + 1) + 3);
        var secondWeek = 0;
 
        if(counter1 > Math.round(totalPayPeriodWorkDays.length / 2)){
            secondWeek = 3;
            firstWeek = 4;
            counter2 = 0;
        }
        else if(counter2 > Math.round(totalPayPeriodWorkDays.length / 2)){
            secondWeek = 4;
            firstWeek = 3;
            counter1 = 0;
        }
        else if(firstWeek === 3){
            secondWeek = 4;
            counter1++;
        }
        else if(firstWeek == 4){
            secondWeek = 4;
            counter2++;
        }
    do {
        if (rowObject[i].SaturdayOff === 'N') {
            if (Math.random() * 100 < 51) {
                if (totalPayPeriodWorkDays[i] !== firstWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                    day7 = rowObject[i].SaturdayStartTime;
                    total7 += 1;
                    
                } else day7 = " ";
            } else day7 = " ";
        } else day7 = " ";
        
        if (rowObject[i].MondayOff === 'N') {
            if (Math.random() * 100 < 51) {
                if (totalPayPeriodWorkDays[i] !== firstWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                    day2 = rowObject[i].MondayStartTime;
                    total2 += 1;
                    
                } else day2 = " ";
            } else day2 = " ";
        } else day2 = " ";
        
        if (rowObject[i].TuesdayOff === 'N') {
            if (Math.random() * 100 < 51) {
                if (totalPayPeriodWorkDays[i] !== firstWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                   day3 = rowObject[i].TuesdayStartTime;
                   total3 += 1;
                    
                } else day3 = " ";
            } else day3 = " ";
        } else day3 = " ";
        if (rowObject[i].WednesdayOff === 'N') {
            if (Math.random() * 100 < 51) {
                if (totalPayPeriodWorkDays[i] !== firstWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                    day4 = rowObject[i].WednesdayStartTime;
                    total4 += 1;
                    
                } else day4 = " ";
            } else day4 = " ";
        } else day4 = " ";
        
        if (rowObject[i].ThursdayOff === 'N') {
            if (Math.random() * 100 < 51) {
                if (totalPayPeriodWorkDays[i] !== firstWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                    day5 = rowObject[i].ThursdayStartTime;
                    total5 += 1;
                    
                } else day5 = " ";
            } else day5 = " ";
        } else day5 = " ";

        if (rowObject[i].FridayOff === 'N') {
            if (Math.random() * 100 < 99) {
                if (totalPayPeriodWorkDays[i] !== firstWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                    day6 = rowObject[i].FridayStartTime;
                    total6 += 1;
                    
                } else day6 = " ";
            } else day6 = " ";
        } else day6 = " ";
        
        if (rowObject[i].SundayOff === 'N') {
            if (Math.random() * 100 < 100) {
                if (totalPayPeriodWorkDays[i] !== firstWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                    day1 = rowObject[i].SundayStartTime;
                    total1 += 1;
                    
                } else day1 = " ";
            } else day1 = " ";
        } else day1 = " ";
        
        if(totalPayPeriodWorkDays[i] !== firstWeek){
           totalPayPeriodWorkDays[i] = 0; 
           day1 = " ";
           day2 = " ";
           day3 = " ";
           day4 = " ";
           day5 = " ";
           day6 = " ";
           day7 = " ";
           total1 = 0;
           total2 = 0;
           total3 = 0;
           total4 = 0;
           total5 = 0;
           total6 = 0;
           total7 = 0;
        }
    } while (totalPayPeriodWorkDays[i] !== firstWeek);
        console.log(rowObject[i].Name, "First Week: ", totalPayPeriodWorkDays[i])
    totalPayPeriodWorkDays[i] = 0; 
    total1 = 0;
    total2 = 0;
    total3 = 0;
    total4 = 0;
    total5 = 0;
    total6 = 0;
    total7 = 0;
    do{
        if (rowObject[i].SaturdayOff === 'N') {
            if (Math.random() * 100 < 51) {
                if (totalPayPeriodWorkDays[i] !== secondWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                    day14 = rowObject[i].SaturdayStartTime;
                    total7 += 1;
                    
                } else day14 = " ";
            } else day14 = " ";
        } else day14 = " ";

        if (rowObject[i].MondayOff === 'N') {
            
            if (Math.random() * 100 < 51) {
                if (totalPayPeriodWorkDays[i] !== secondWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                    day9 = rowObject[i].MondayStartTime;
                    total2 += 1;
                } else day9 = " ";
            } else day9 = " ";
        } else day9 = " ";
        if (rowObject[i].TuesdayOff === 'N') {
            if (Math.random() * 100 < 51) {
                if (totalPayPeriodWorkDays[i] !== secondWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                    day10 = rowObject[i].TuesdayStartTime;
                    total3 += 1;
                } else day10 = " ";
            } else day10 = " ";
        } else day10 = " ";
        if (rowObject[i].WednesdayOff === 'N') {
            if (Math.random() * 100 < 51) {
                if (totalPayPeriodWorkDays[i] !== secondWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                    day11 = rowObject[i].WednesdayStartTime;
                    total4 += 1;
                    
                } else day11 = " ";
            } else day11 = " ";
        } else day11 = " ";
        if (rowObject[i].ThursdayOff === 'N') {
            if (Math.random() * 100 < 51) {
                if (totalPayPeriodWorkDays[i] !== secondWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                    day12 = rowObject[i].ThursdayStartTime;
                    total5 += 1;
                    
                } else day12 = " ";
            } else day12 = " ";
        } else day12 = " ";

        if (rowObject[i].FridayOff === 'N') {
            if (Math.random() * 100 < 51) {
                if (totalPayPeriodWorkDays[i] !== secondWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                    day13 = rowObject[i].FridayStartTime;
                    total6 += 1;
                    
                } else day13 = " ";
            } else day13 = " ";
        } else day13 = " ";
                if (rowObject[i].SundayOff === 'N') {
            if (Math.random() * 100 < 99) {
                if (totalPayPeriodWorkDays[i] !== secondWeek) {
                    //adds the amount of days worked if scheduled
                    totalPayPeriodWorkDays[i] += 1;
                    day8 = rowObject[i].SundayStartTime;
                    total1 += 1;

                } else day8 = " ";
            } else day8 = " ";
        } else day8 = " ";
        
        if(totalPayPeriodWorkDays[i] !== secondWeek){
           totalPayPeriodWorkDays[i] = 0; 
           day8 = " ";
           day9 = " ";
           day10 = " ";
           day11 = " ";
           day12 = " ";
           day13 = " ";
           day14 = " ";
           total1 = 0;
           total2 = 0;
           total3 = 0;
           total4 = 0;
           total5 = 0;
           total6 = 0;
           total7 = 0;
        }
    } while (totalPayPeriodWorkDays[i] !== secondWeek);
    console.log(rowObject[i].Name, "Second Week: ", totalPayPeriodWorkDays[i]);
    
    
    document.write('<td width="100px">', day1, '</td>');
    document.write('<td width="100px">', day2, '</td>');
    document.write('<td width="100px">', day3, '</td>');
    document.write('<td width="100px">', day4, '</td>');
    document.write('<td width="100px">', day5, '</td>');
    document.write('<td width="100px">', day6, '</td>');
    document.write('<td width="100px">', day7, '</td>');
    document.write('<td width="100px">', day8, '</td>');
    document.write('<td width="100px">', day9, '</td>');
    document.write('<td width="100px">', day10, '</td>');
    document.write('<td width="100px">', day11, '</td>');
    document.write('<td width="100px">', day12, '</td>');
    document.write('<td width="100px">', day13, '</td>');
    document.write('<td width="100px">', day14, '</td>');
}

              document.getElementById("jsondata").innerHTML = JSON.stringify(rowObject,undefined,4)
         });
        }
    }
});
</script>
</html>
